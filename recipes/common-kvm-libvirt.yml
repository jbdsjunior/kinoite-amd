modules:
  - type: rpm-ostree
    install:
      - qemu-kvm
      - libvirt
      - libvirt-client

      # --- Interface & Tools ---
      - virt-manager # Interface Gráfica
      - virt-install # Criação de VM via linha de comando

      # --- Suporte Moderno (Essencial para Windows 11) ---
      - edk2-ovmf # Suporte a UEFI (BIOS moderno)
      - swtpm # Emulador TPM (Exigido pelo Win11)

      # --- Manipulação de Imagens (Opcional, mas útil) ---
      - guestfs-tools # Permite editar imagens de disco (virt-customize)

  - type: systemd
    system:
      enabled:
        - libvirtd
        - qemu-guest-agent

  - type: files
    files:
      - source: just/virt-setup.just
        destination: /usr/share/ublue-os/just/60-virt-setup.just

  - type: kargs
    kargs:
      - amd_iommu=on
      - iommu=pt
      - kvm_amd.npt=1
      - kvm_amd.avic=1
      - kvm_amd.nested=1
      - kvm_amd.sev=1
