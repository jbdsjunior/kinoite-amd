---
modules:
  - type: dnf
    install:
      packages:
        - "@virtualization"
      exclude:
        - virt-viewer

  - type: systemd
    system:
      enabled:
        - libvirtd.service
        - qemu-guest-agent.service

  - type: files
    files:
      - source: just/60-kvm-setup.just
        destination: /usr/share/ublue-os/just/60-kvm-setup.just

  - type: kargs
    kargs:
      - amd_iommu=on
      - iommu=pt
      - kvm_amd.npt=1
      - kvm_amd.avic=1
      - kvm_amd.nested=1
      - kvm_amd.sev=1
